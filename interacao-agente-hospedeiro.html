<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTERAÇÃO AGENTE HOSPEDEIRO II - Calculadora de Notas</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="container">
            <h1>Calculadora de Notas</h1>
            <h2>4° Período</h2>
        </div>
    </header>

    <main class="container">
        <br>
        <a href="calculadora-hub.html" class="voltar">← Voltar para página inicial</a>

        <div class="calculadora">
            <h2>INTERAÇÃO AGENTE HOSPEDEIRO II</h2>

            <form id="calculadora-form">

                <div class="grade-input-section">
                    <div class="grade-input-group main-grade p1-toggle-header" data-target-details="p1ComponentsDetailsInteracao">
                        <label for="p1-completa">P1 (10 pontos):</label>
                        <input type="number" id="p1-completa" min="0" max="10" step="0.01" placeholder="Digite a nota da P1">
                        <span class="p1-components-label-action">CALCULAR P1 POR COMPONENTES</span>
                        <button type="button" class="expand-arrow-button">
                            <span class="arrow-icon">▼</span>
                        </button>
                    </div>
                    <div class="p1-components-details" id="p1ComponentsDetailsInteracao" style="display: none;">
                        <div class="form-group">
                            <label for="p1-teorica-1">
                                <span>Avaliação Teórica 1</span>
                                <span class="points-label">(6 pontos)</span>
                            </label>
                            <input type="number" id="p1-teorica-1" min="0" max="6" step="0.01" placeholder="Nota da Avaliação Teórica 1">
                        </div>
                        <div class="form-group">
                            <label for="p1-quest-1">
                                <span>Questionário Pontuado 1</span>
                                <span class="points-label">(0,5 pontos)</span>
                            </label>
                            <input type="number" id="p1-quest-1" min="0" max="0.5" step="0.01" placeholder="Nota do Questionário 1">
                        </div>
                        <div class="form-group">
                            <label for="p1-quest-2">
                                <span>Questionário Pontuado 2</span>
                                <span class="points-label">(0,5 pontos)</span>
                            </label>
                            <input type="number" id="p1-quest-2" min="0" max="0.5" step="0.01" placeholder="Nota do Questionário 2">
                        </div>
                        <div class="form-group">
                            <label for="p1-cafe-1">
                                <span>World Café 1</span>
                                <span class="points-label">(1 ponto)</span>
                            </label>
                            <input type="number" id="p1-cafe-1" min="0" max="1" step="0.01" placeholder="Nota do World Café 1">
                        </div>
                        <div class="form-group">
                            <label for="p1-cafe-2">
                                <span>World Café 2</span>
                                <span class="points-label">(1 ponto)</span>
                            </label>
                            <input type="number" id="p1-cafe-2" min="0" max="1" step="0.01" placeholder="Nota do World Café 2">
                        </div>
                        <div class="form-group">
                            <label for="p1-caso-1">
                                <span>Discussão de Caso Clínico 1</span>
                                <span class="points-label">(0,5 pontos)</span>
                            </label>
                            <input type="number" id="p1-caso-1" min="0" max="0.5" step="0.01" placeholder="Nota do Caso Clínico 1">
                        </div>
                        <div class="form-group">
                            <label for="p1-caso-2">
                                <span>Discussão de Caso Clínico 2</span>
                                <span class="points-label">(0,5 pontos)</span>
                            </label>
                            <input type="number" id="p1-caso-2" min="0" max="0.5" step="0.01" placeholder="Nota do Caso Clínico 2">
                        </div>
                    </div>
                </div>

                <div class="grade-input-section">
                    <div class="grade-input-group main-grade p2-toggle-header" data-target-details="p2ComponentsDetailsInteracaoP2">
                        <label for="p2-completa">P2 (10 pontos):</label>
                        <input type="number" id="p2-completa" min="0" max="10" step="0.01" placeholder="Digite a nota da P2">
                        <span class="p2-components-label-action">CALCULAR P2 POR COMPONENTES</span>
                        <button type="button" class="expand-arrow-button">
                            <span class="arrow-icon">▼</span>
                        </button>
                    </div>
                    <div class="p2-components-details" id="p2ComponentsDetailsInteracaoP2" style="display: none;">
                      <div class="form-group">
                               <label for="p2-teorica-2">
                                   <span>Avaliação Teórica 2</span>
                                   <span class="points-label">(3 pontos)</span>
                               </label>
                               <input type="number" id="p2-teorica-2" min="0" max="3" step="0.01" placeholder="Nota da Avaliação Teórica 2">
                            </div>
                            <div class="form-group">
                               <label for="p2-teorica-3">
                                   <span>Avaliação Teórica 3</span>
                                   <span class="points-label">(5 pontos)</span>
                               </label>
                               <input type="number" id="p2-teorica-3" min="0" max="5" step="0.01" placeholder="Nota da Avaliação Teórica 3">
                            </div>
                            <div class="form-group">
                                <label for="p2-caso-3">
                                    <span>Discussão de Caso Clínico 3</span>
                                    <span class="points-label">(0,5 pontos)</span>
                                </label>
                                <input type="number" id="p2-caso-3" min="0" max="0.5" step="0.01" placeholder="Nota do Caso Clínico 3">
                            </div>
                            <div class="form-group">
                                <label for="p2-quest-3">
                                    <span>Questionário Pontuado 3</span>
                                    <span class="points-label">(0,5 pontos)</span>
                                </label>
                                <input type="number" id="p2-quest-3" min="0" max="0.5" step="0.01" placeholder="Nota do Questionário 3">
                            </div>
                            <div class="form-group">
                                <label for="p2-quest-4">
                                    <span>Questionário Pontuado 4</span>
                                    <span class="points-label">(0,5 pontos)</span>
                                </label>
                                <input type="number" id="p2-quest-4" min="0" max="0.5" step="0.01" placeholder="Nota do Questionário 4">
                            </div>
                            <div class="form-group">
                                <label for="p2-quest-5">
                                    <span>Questionário Pontuado 5</span>
                                    <span class="points-label">(0,5 pontos)</span>
                                </label>
                                <input type="number" id="p2-quest-5" min="0" max="0.5" step="0.01" placeholder="Nota do Questionário 5">
                            </div>
                    </div>
                </div>

                <div class="buttons">
                    <button type="button" id="calcular" class="btn-calcular">Calcular</button>
                    <button type="button" id="limpar" class="btn-limpar">Limpar</button>
                </div>
            </form>

            <div id="resultado" class="resultado" style="display: none;">
                <h3>Resultado:</h3>
                <div id="media-final" style="display: none;" class="media-final-wrapper">
                    <p>Sua média final é: <strong id="nota-final">0.00</strong></p>
                    <p id="mensagem"></p>
                </div>
                <div id="notas-necessarias"></div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>Autoria de Gabriel Papa</p>
        </div>
    </footer>

    <script src="js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calcularBtn = document.getElementById('calcular');
            const limparBtn = document.getElementById('limpar');
            if (calcularBtn) calcularBtn.addEventListener('click', calcularNota);
            if (limparBtn) limparBtn.addEventListener('click', () => limparCampos(document.getElementById('calculadora-form')));
        });

        function getNota(id) {
            const val = document.getElementById(id).value;
            return val !== '' ? parseFloat(val) : null;
        }

        function calcularNota() {
            const p1CompsIds = ['p1-teorica-1', 'p1-quest-1', 'p1-quest-2', 'p1-cafe-1', 'p1-cafe-2', 'p1-caso-1', 'p1-caso-2'];
            const p2CompsIds = ['p2-teorica-2', 'p2-teorica-3', 'p2-caso-3', 'p2-quest-3', 'p2-quest-4', 'p2-quest-5'];
            
            let p1 = getNota('p1-completa');
            const p1Vals = p1CompsIds.map(getNota);
            if (p1 === null && p1Vals.every(n => n !== null)) {
                p1 = p1Vals.reduce((a, b) => a + b, 0);
            }
            
            let p2 = getNota('p2-completa');
            const p2Vals = p2CompsIds.map(getNota);
            if (p2 === null && p2Vals.every(n => n !== null)) {
                p2 = p2Vals.reduce((a, b) => a + b, 0);
            }
            
            const resultadoDiv = document.getElementById('resultado');
            const mediaFinalDiv = document.getElementById('media-final');
            const notasNecessariasDiv = document.getElementById('notas-necessarias');
            const notaFinalEl = document.getElementById('nota-final');
            const mensagemEl = document.getElementById('mensagem');

            // --- RESET VISUAL COMPLETO ---
            mediaFinalDiv.style.display = 'none';
            notasNecessariasDiv.innerHTML = '';
            mediaFinalDiv.classList.remove('aprovado', 'recuperacao', 'reprovado');
            mensagemEl.classList.remove('aprovado-msg', 'recuperacao-msg', 'reprovado-msg');
            const linkPfWrapper = mediaFinalDiv.querySelector('.link-pf-wrapper');
            if (linkPfWrapper) linkPfWrapper.remove();
            // --- FIM DO RESET ---
            
            const PASSING_GRADE = 7;

            if (p1 !== null && p2 !== null) {
                notasNecessariasDiv.style.display = 'none';
                mediaFinalDiv.style.display = 'block';

                const mediaFinalValor = (p1 + p2) / 2;
                notaFinalEl.textContent = formatarNota(mediaFinalValor);
                mensagemEl.textContent = obterMensagem(mediaFinalValor);

                if (mediaFinalValor >= PASSING_GRADE) {
                    mediaFinalDiv.classList.add('aprovado');
                    mensagemEl.classList.add('aprovado-msg');
                } else if (mediaFinalValor >= 3) {
                    mediaFinalDiv.classList.add('recuperacao');
                    mensagemEl.classList.add('recuperacao-msg');
                    const linkPf = document.createElement('p');
                    linkPf.className = 'link-pf-wrapper';
                    linkPf.innerHTML = `<a href="prova-final.html" class="btn-calcular" style="display: inline-block; margin-top: 10px; text-decoration: none; text-align: center;">Cálculo da Prova Final</a>`;
                    mediaFinalDiv.appendChild(linkPf);
                } else {
                    mediaFinalDiv.classList.add('reprovado');
                    mensagemEl.classList.add('reprovado-msg');
                }
            } else {
                notasNecessariasDiv.style.display = 'block';
                const allComponents = [
                    ...p1CompsIds.map((id, i) => ({ id, max: parseFloat(document.getElementById(id).max) || 0, p: 'P1', value: p1Vals[i] })),
                    ...p2CompsIds.map((id, i) => ({ id, max: parseFloat(document.getElementById(id).max) || 0, p: 'P2', value: p2Vals[i] }))
                ];

                let currentSum = 0;
                if (p1 !== null) currentSum += p1;
                if (p2 !== null) currentSum += p2;

                const missingComponents = [];
                allComponents.forEach(comp => {
                    if (comp.value !== null) {
                        if ((comp.p === 'P1' && p1 === null) || (comp.p === 'P2' && p2 === null)) {
                           currentSum += comp.value;
                        }
                    } else {
                        if ((comp.p === 'P1' && p1 === null) || (comp.p === 'P2' && p2 === null)) {
                            missingComponents.push(comp);
                        }
                    }
                });
                
                const neededSum = 14 - currentSum;
                const missingSumMax = missingComponents.reduce((sum, comp) => sum + comp.max, 0);
                
                let html = '<h4>Notas necessárias para média 7:</h4><ul>';
                
                if (neededSum > missingSumMax + 0.01) {
                    html += '<li>Com as notas atuais, não é possível atingir média 7.</li>';
                } else {
                    const missingP1 = missingComponents.filter(c => c.p === 'P1');
                    const missingP2 = missingComponents.filter(c => c.p === 'P2');
                    
                    if (missingP1.length > 0) {
                         const targetP1 = (p2 !== null) ? (14 - p2) : (p1 === null && p2 === null ? PASSING_GRADE : neededSum);
                         html += `<li style="list-style-type: none;"><strong>--- Para P1 atingir ~${formatarNota(targetP1)} ---</strong></li>`;
                         missingP1.forEach(comp => {
                            const needed = missingSumMax > 0 ? (neededSum * comp.max) / missingSumMax : 0;
                            const label = document.querySelector(`label[for=${comp.id}] span:first-child`).textContent;
                            html += `<li style="list-style-type: '→ '; padding-left: 10px;">${label}: <strong>${formatarNota(Math.max(0, needed))}</strong> (de ${comp.max})</li>`;
                        });
                    }
                     if (missingP2.length > 0) {
                         const targetP2 = (p1 !== null) ? (14 - p1) : (p1 === null && p2 === null ? PASSING_GRADE : neededSum);
                         html += `<li style="list-style-type: none;"><strong>--- Para P2 atingir ~${formatarNota(targetP2)} ---</strong></li>`;
                         missingP2.forEach(comp => {
                            const needed = missingSumMax > 0 ? (neededSum * comp.max) / missingSumMax : 0;
                            const label = document.querySelector(`label[for=${comp.id}] span:first-child`).textContent;
                            html += `<li style="list-style-type: '→ '; padding-left: 10px;">${label}: <strong>${formatarNota(Math.max(0, needed))}</strong> (de ${comp.max})</li>`;
                        });
                    }
                }
                
                html += '</ul>';
                notasNecessariasDiv.innerHTML = html;
            }
            resultadoDiv.style.display = 'block';
        }
    </script>
</body>
</html>
